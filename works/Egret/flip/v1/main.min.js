var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.bottom=416,e.objs=new Array,e.GameOver=!1,e.Xstep=0,e.Ystep=0,e.Zstep=.98,e.Gstart=!1,e.JumpCount=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("main")},e.prototype.onResourceLoadComplete=function(t){"main"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"main"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.createGameScene=function(){for(var t=0;4>t;t++)this.bg=this.createBitmapByName("tile_bg"),this.addChild(this.bg),this.bg.x=this.bg.width*t;this.finish=this.createBitmapByName("finish"),this.addChild(this.finish),this.finish.x=1e3,this.finish.y=this.bottom-this.finish.height;for(var e=1;4>e;e++){var i=this.createBitmapByName("object_0"+e);this.addChild(i),i.x=150+200*e,i.y=this.bottom-i.height,this.objs.push(i)}this.GstartTip=this.createBitmapByName("tapToStart"),this.addChild(this.GstartTip),this.GstartTip.x=230,this.GstartTip.y=this.bottom-this.GstartTip.height,this.GupTip=this.createBitmapByName("tapToJump"),this.addChild(this.GupTip),this.GupTip.x=230,this.GupTip.y=this.bottom-this.GupTip.height,this.GupTip.visible=!1,this.boy=this.createBitmapByName("green_boy"),this.addChild(this.boy),this.boy.x=200,this.boy.y=this.bottom-this.boy.height,this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.touchEnabled=!0,this.startBgMusic()},e.prototype.onEnterFrame=function(t){this.Gstart&&!this.GameOver&&(this.GupTip.x=this.boy.x+50,this.Ystep+=this.Zstep,this.boy.x+=this.Xstep,this.boy.y+=this.Ystep,this.boy.y>=this.bottom-this.boy.height&&(this.boy.y=this.bottom-this.boy.height,this.Ystep=0,this.JumpCount=0),this.testobjects())},e.prototype.onTouchBegin=function(t){return this.Gstart?this.JumpCount<3&&(this.GupTip.visible=!1,this.Ystep=-14,this.JumpCount++):(this.Gstart=!0,this.Xstep=2,this.GstartTip.visible=!1,this.GupTip.visible=!0),this.GameOver?(this.GameOver=!1,this.JumpCount=0,this.boy.x=200,void(this.boy.y=this.bottom-this.boy.height)):void 0},e.prototype.testobjects=function(){for(var t=0;t<this.objs.length;t++){var e=this.objs[t];this.testboy(e)&&(alert("game over! click game again."),this.GameOver=!0)}},e.prototype.testboy=function(t){return t.hitTestPoint(this.boy.x+.5*this.boy.width,this.boy.y+.5*this.boy.height)},e.prototype.startBgMusic=function(){var t=new egret.Sound,e="resource/assets/sound/BG.mp3";t.addEventListener(egret.Event.COMPLETE,this.onLoadSoundComplete,this),t.load(e)},e.prototype.onLoadSoundComplete=function(t){var e=t.target,i=e.play(0,0);i.volume=0,i.addEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this)},e.prototype.onSoundComplete=function(t){egret.log("onSoundComplete")},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");